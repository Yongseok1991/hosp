<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Q&A ê²Œì‹œíŒ - ìˆ˜ì •</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>ê°„ë‹¨í•œ ì§€ë„ í‘œì‹œí•˜ê¸°</title>
  <script
          src="https://code.jquery.com/jquery-3.6.0.min.js"
          integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
          crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</head>

<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Yongdol</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">PCR ë³‘ì› ì¡°íšŒ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/list">ê²½ê¸°ì§€ì—­í™”í ì‚¬ìš©ì²˜ ì¡°íšŒ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/qna">Q&A ê²Œì‹œíŒ</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <h2>Q&A ìˆ˜ì •</h2>
  <p>ì‚¬ì´íŠ¸ ì´ìš© ë¶ˆí¸ì‚¬í•­ì´ë‚˜ ì§ˆë¬¸ì‚¬í•­ì„ ì˜¬ë ¤ì£¼ì„¸ìš”</p>
  <form>
    <input type="hidden" name="id" id="qnaId" th:value="${board.id}">
    <div class="form-group">
      <label for="title" class="form-label">Title:</label>
      <input type="text" class="form-control" placeholder="Enter Title" th:value="${board.title}" id="title" required>
    </div>

    <div class="form-group">
      <label for="writer" class="form-label">Writer:</label>
      <input type="text" class="form-control" placeholder="Enter Title" th:value="${board.writer}" id="writer" readonly>
    </div>

    <div class="form-group">
      <label for="content">content:</label>
      <textarea class="form-control summernote" rows="5" id="content" required></textarea>
    </div>
  </form>
  <button id="btn-save" class="btn btn-primary">ë“±ë¡</button>
</div>
</form>
<div class="jumbotron text-center" style="margin-bottom: 0">
  <p>Created By Yong</p>
  <p>ğŸ“ 010-5023-2463</p>
  <p>ğŸ´ ê²½ê¸°ë„ ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬</p>
</div>

<script>
  $(function() {

    $('#btn-save').on('click', () => {
      let title = $('#title').val();
      let content= $('#content').val();
      if(title == '') {
        alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”')
        return false;
      }

      if(content == '') {
        alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”')
        return false;
      }

      let data = {
        id: $('#qnaId').val(),
        title: title,
        content: content
      };
      let save = async () => {
        let response = await fetch('/api/qna/up', {
          method: 'PUT',
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        })
        alert("ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        location.href="/qna";
      }
        save();
    })

    $('.summernote').summernote({
      height: 300,                 // ì—ë””í„° ë†’ì´
      minHeight: null,             // ìµœì†Œ ë†’ì´
      maxHeight: null,             // ìµœëŒ€ ë†’ì´
      focus: true,                  // ì—ë””í„° ë¡œë”©í›„ í¬ì»¤ìŠ¤ë¥¼ ë§ì¶œì§€ ì—¬ë¶€
      callbacks: {	//ì—¬ê¸° ë¶€ë¶„ì´ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•˜ëŠ” ë¶€ë¶„
        onImageUpload: function(files) {
          const _this = this;
          console.log('onImageUpload invoked.')
          Array.from(files).forEach( x => uploadSummernoteImageFile(x, _this));
        },
        onPaste: function(e) {
          let clipboardData = e.originalEvent.clipboardData;
          if (clipboardData && clipboardData.items && clipboardData.items.length) {
            console.log("onPaste invoked.");
            console.log("clip: " + clipboardData);
            clipboardData.forEach( x => {
              let item = clipboardData.x
              if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
                e.preventDefault();
              }
            });

          }
        }
      }
    });

  })

  function uploadSummernoteImageFile(file, editor) {
    let data = new FormData();
    data.append("file", file);

    $.ajax({
      data : data,
      type : "POST",
      url : "/uploadSummernoteImageFile",
      contentType : false,
      processData : false,
      success : function(data) {
        //í•­ìƒ ì—…ë¡œë“œëœ íŒŒì¼ì˜ urlì´ ìˆì–´ì•¼ í•œë‹¤.
        $(editor).summernote('insertImage', data.url);
        if(data.responseCode === 'error') {
            alert('ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }
    });
  }


  /**
   * ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ
   */

</script>
</body>

</html>