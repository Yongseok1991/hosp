<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>키워드 조합</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=1wjo4eezo5"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .inputbox {
            margin-right: 5px;
        }
        textarea {
            resize: none;
            overflow: hidden;
        }
        .item-list {
            font-weight: bold;
        }
        #inputbox3 {
            margin-left: 5px;
        }
    </style>
</head>

<body>

<div th:insert="/nav :: nav"></div>

<div class="container" style="margin-top: 20px">
    <h3 style="display: inline"><strong>키워드 조합하기</strong></h3>
    <button
            style="float: right"
            class="btn btn-success"
            onclick="resetFunction();"
    >
        리셋
    </button>
    <hr />
    <p>√ 한 줄에 하나의 키워드를 입력해주세요.</p>
    <p>√ 하나의 textarea는 10개까지 입력 가능합니다. 10개를 초과할 경우 textarea를 추가해주세요.</p>
    <p>√ textarea는 총 3개까지 가능합니다.</p>
    <p>√ 키워드는 4개 이상 입력해주세요. (중복된 키워드는 자동제거)</p>

    <div id="inputBlock">
        <textarea
                class="inputbox"
                id="inputbox1"
                cols="30"
                rows="10"
        ></textarea>
    </div>
    <div>
        <table class="table table-striped">
            <thead>
            <tr>
                <td>
                    <p id="textLength" style="display: inline; font-weight: bold">
                        키워드
                    </p>
                    <button
                            style="float: right"
                            id="keyWordBtn"
                            class="btn btn-primary"
                            onclick="keywordCombination();"
                    >
                        키워드 조합
                    </button>
                </td>
            </tr>
            </thead>
            <tbody>
            <tr id="key"></tr>
            </tbody>
        </table>
    </div>
    <button id="areaAdd" class="btn btn-warning">textarea 추가</button>
    <button id="areaDelete" class="btn btn-danger">textarea 제거</button>
</div>
<script>
    $(function () {
        let sId = 1;
        $(document).on("click", "#areaAdd", () => {
            if (sId === 3) {
                alert("더이상 추가 하실 수 없습니다.");
                return false;
            }
            $("#inputBlock").append(
                `<textarea class="inputbox" id='inputbox${++sId}' cols='30' rows='10'></textarea>`
            );
        });

        $(document).on("click", "#areaDelete", () => {
            if (sId === 1) {
                alert("더이상 제거 하실 수 없습니다.");
                return false;
            }
            --sId;
            $("#inputBlock :last-child").remove();
        });
    });

    function keywordCombination() {
        $("#key").html("");
        let str = [];
        let inputbox = $(".inputbox");
        if (inputbox.val().length == 0) {
            alert("키워드를 입력해주세요.");
            return false;
        }

        $.each(inputbox, (i, item) => {
            let items = $(item).val().split("\n");
            $.each(items, (i, result) => {
                if (result != "") {
                    str.push(result);
                }
            });
        });

        let strDup = str.filter((val, idx) => {
            return str.indexOf(val) === idx;
        });
        if (strDup.length < 4) {
            alert("키워드를 4개 이상 입력해주세요. (중복된 키워드 자동 제거)");
            return false;
        }
        let combi = getCombinations(strDup, 3);
        $.each(combi, (i, com) => {
            $("#key").append(
                `<li class='item-list'>${com.toString().replaceAll(",", " ")}</li>`
            );
        });
        let keywordLength = $(".item-list").length;
        $("#textLength").text(`키워드 (${keywordLength} 개)`);
    }

    function getCombinations(arr, selectNumber) {
        const results = [];
        if (selectNumber === 1) return arr.map((value) => [value]);

        arr.forEach((fixed, index, origin) => {
            const rest = origin.slice(index + 1);
            const combinations = getCombinations(rest, selectNumber - 1);
            const attached = combinations.map((combination) => [
                fixed,
                ...combination,
            ]);
            results.push(...attached);
        });
        return results;
    }

    function resetFunction() {
        location.reload();
    }
</script>

</body>

</html>