<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Q&A ê²Œì‹œíŒ - ë“±ë¡</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>ê°„ë‹¨í•œ ì§€ë„ í‘œì‹œí•˜ê¸°</title>
  <script
          src="https://code.jquery.com/jquery-3.6.0.min.js"
          integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
          crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="/util/summernote-lite.css" rel="stylesheet">
  <script src="/util/summernote-lite.js"></script>
</head>

<body>

<div th:insert="/nav :: nav"></div>

<div class="container">
  <h2>Q&A</h2>
  <p>ì‚¬ì´íŠ¸ ì´ìš© ë¶ˆí¸ì‚¬í•­ì´ë‚˜ ì§ˆë¬¸ì‚¬í•­ì„ ì˜¬ë ¤ì£¼ì„¸ìš”</p>
  <form>
    <div class="form-group">
      <label for="title" class="form-label">Title:</label>
      <input type="text" class="form-control" placeholder="Enter Title" id="title" autofocus required>
    </div>

    <div class="form-group">
      <label for="writer" class="form-label">Writer:</label>
      <input type="text" class="form-control" placeholder="Enter Title" id="writer" required>
    </div>

    <div class="form-group">
      <label for="content">content:</label>
      <textarea class="form-control summernote" rows="5" id="content" required></textarea>
    </div>
  </form>
  <button id="btn-save" class="btn btn-primary">ë“±ë¡</button>
</div>
</form>
<div class="jumbotron text-center" style="margin-bottom: 0">
  <p>Created By Yong</p>
  <p>ğŸ“ 010-5023-2463</p>
  <p>ğŸ´ ê²½ê¸°ë„ ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬</p>
</div>

<script>
  $(function() {

    $('#btn-save').on('click', () => {
      let title = $('#title').val();
      let writer = $('#writer').val();
      let content= $('#content').val();
      if(title == '') {
        alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”')
        return false;
      }
      if(writer == '') {
        alert('ì‘ì„±ìë¥¼ ì…ë ¥í•˜ì„¸ìš”')
        return false;
      }
      if(content == '') {
        alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”')
        return false;
      }

      let data = {
        title: title,
        writer: writer,
        content: content
      };
      let save = async () => {
        let response = await fetch('/qnaApi', {
          method: 'POST',
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        })
        alert("ê¸€ì“°ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        location.href="/qna";
      }
        save();
    })

    $('.summernote').summernote({
      height: 300,                 // ì—ë””í„° ë†’ì´
      minHeight: null,             // ìµœì†Œ ë†’ì´
      maxHeight: null,             // ìµœëŒ€ ë†’ì´
      placeholder: 'write here..',
      spellcheck: true,
      fontNames: ['Arial', 'd2Coding', 'Hack', 'Comic Sans MS', 'Courier New','ë§‘ì€ ê³ ë”•','ê¶ì„œ','êµ´ë¦¼ì²´','êµ´ë¦¼','ë‹ì›€ì²´','ë°”íƒ•ì²´'],
      fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72'],
      toolbar: [
        // [groupName, [list of button]]
        ['fontname', ['fontname']],
        ['fontsize', ['fontsize']],
        ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
        ['color', ['forecolor','color']],
        ['table', ['table']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']],
        ['insert',['picture']],
        ['view', ['help']]
      ],
      callbacks: {	//ì—¬ê¸° ë¶€ë¶„ì´ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•˜ëŠ” ë¶€ë¶„

        onImageUpload: function(files) {
          console.log('onImageUpload invoked.');
          const _this = this;
          Array.from(files).forEach(x => {
            return uploadSummernoteImageFile(x, _this);
          })
          // console.log(Array.isArray(files));
        },
        onPaste: function(e) {
          const _this = this;
          console.log('onpaste invoked')
          let clipboardData = e.originalEvent.clipboardData;
          let textData = clipboardData.getData("Text");
          if(textData) {
              console.log('textData invoked.');
              let bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text')
              e.preventDefault();
              console.log(bufferText);
              document.execCommand('insertText', false, bufferText);
          }
        }
      }
    });
  })

  function uploadSummernoteImageFile(file, editor) {
    let data = new FormData();
    data.append("file", file);
    $.ajax({
      data : data,
      type : "POST",
      url : "/uploadSummernoteImageFile",
      contentType : false,
      processData : false,
      success : function(data) {
        //í•­ìƒ ì—…ë¡œë“œëœ íŒŒì¼ì˜ urlì´ ìˆì–´ì•¼ í•œë‹¤.
        $(editor).summernote('insertImage', data.url);
        console.log(data.url);
        console.log(data.responseCode);
      }
    });
  }


  /**
   * ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ
   */

</script>
</body>

</html>